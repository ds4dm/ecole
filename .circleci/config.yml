version: 2.1

workflows:

  release:
    jobs:
      - check_version:
          filters:  # Only runs on tag such as v3.0.23
            branches:
              ignore: '/.*/'
            tags:
              only: '/^v\d+\.\d+\.\d+/'


# Execute a set of commands in a clean image
jobs:

  check_version:
    docker:
      - image: "cimg/base:2020.12"
        auth:
          username: "$DOCKERHUB_USERNAME"
          password: "$DOCKERHUB_PASSWORD"
    steps:
      - checkout
      - run:
          name: "Verifiying version file matches tag"
          command: ./dev/run.sh test-version "${$CIRCLE_TAG}"
